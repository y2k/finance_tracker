package y2k.finance_tracker.android;import android.app.Activity;import android.content.Intent;import android.net.Uri;import android.os.Bundle;import android.webkit.WebView;import android.webkit.WebChromeClient;import android.webkit.ValueCallback;import android.webkit.JavascriptInterface;class Main{public static class MainActivity extends Activity{public java.util.List<Object> state;@Override public void onCreate(Bundle p0){super.onCreate(p0);activity_onCreate(this,p0);}@Override public void onActivityResult(int p0, int p1, Intent p2){super.onActivityResult(p0,p1,p2);activity_onActivityResult(this,p0,p1,p2);}}public static Object activity_onCreate(final MainActivity self,final Bundle bundle){final var webview=new WebView(self);final var webSettings=webview.getSettings();self.setContentView(webview);webSettings.setDomStorageEnabled(true);webSettings.setJavaScriptEnabled(true);webSettings.setAllowFileAccess(true);webSettings.setAllowFileAccessFromFileURLs(true);webSettings.setAllowUniversalAccessFromFileURLs(true);webview.addJavascriptInterface(new WebViewJsListener(self,webview),"Android");webview.setWebChromeClient(new WebChromeClientImpl());webview.loadUrl(y2k.RT.str("file://",self.getFilesDir(),"/index.html"));final var p__2=(Object)null;return p__2;}private static Object filePathCallbackRef=new java.util.concurrent.atomic.AtomicReference(null);public static Object activity_onActivityResult(final MainActivity self,final Object requestCode,final int resultCode,final Intent data){final var results=WebChromeClient.FileChooserParams.parseResult(resultCode,data);final var filePathCallback=((ValueCallback<Uri[]>)((java.util.concurrent.atomic.AtomicReference<Object>)filePathCallbackRef).get());filePathCallback.onReceiveValue(results);((java.util.concurrent.atomic.AtomicReference<Object>)filePathCallbackRef).set(null);final var p__3=(Object)null;return p__3;}public static class WebChromeClientImpl extends WebChromeClient{public java.util.List<Object> state;public boolean onShowFileChooser(WebView p0, ValueCallback<Uri[]> p1, WebChromeClient.FileChooserParams p2){return (boolean)wvc_onShowFileChooser(this,p0,p1,p2);}}private static Object wvc_onShowFileChooser(final Object self,final WebView wv,final Object filePathCallback,final WebChromeClient.FileChooserParams fileChooserParams){final var intent=fileChooserParams.createIntent();final var activity=((Activity)wv.getContext());activity.startActivityForResult(Intent.createChooser(intent,"Выберите изображение"),1);((java.util.concurrent.atomic.AtomicReference<Object>)filePathCallbackRef).set(filePathCallback);final var p__4=true;return p__4;}public static class WebViewJsListener extends Object{public java.util.List<Object> state;public WebViewJsListener(Activity p0,WebView p1){state=java.util.List.of(p0,p1);}@JavascriptInterface public void dispatch(String p0, String p1){wv_dispatch(this,p0,p1);}}private static Object handle_event(final WebView wv,final Object event,final Object payload){final var gen_1=event;final var p__5=y2k.RT.println("FIXME: ",event," | ",payload);return p__5;}private static Object wv_dispatch(final WebViewJsListener self,final Object event,final Object payload){final var p__1=self.state;final var activity=(Activity)y2k.RT.get(p__1,0);final var wv=(WebView)y2k.RT.get(p__1,1);activity.runOnUiThread(()->{handle_event(wv,event,payload);});final var p__6=(Object)null;return p__6;}}
